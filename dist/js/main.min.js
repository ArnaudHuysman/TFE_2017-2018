"use strict";var scene,scene2,camera,fieldOfView,aspectRatio,nearPlane,farPlane,HEIGHT,WIDTH,renderer,container,raycaster,plane,intersectPoint,hemisphereLight,shadowLight,Colors={orange:15023360,yellow:16771328,white:16580599,blue:2203808,blueDark:288869},Player={isRightClick:!1,isLeftClick:!1,targetPos:{x:0,y:0}},Game={collidableMesh:[]};function createScene(){HEIGHT=window.innerHeight,WIDTH=window.innerWidth,scene=new THREE.Scene,aspectRatio=WIDTH/HEIGHT,fieldOfView=30,nearPlane=1,farPlane=1e4,(camera=new THREE.PerspectiveCamera(fieldOfView,aspectRatio,nearPlane,farPlane)).position.z=600,camera.position.y=-600,camera.lookAt(new THREE.Vector3(0,0,0)),plane=new THREE.Plane(new THREE.Vector3(1,0,0),10),intersectPoint=new THREE.Vector3,(renderer=new THREE.WebGLRenderer({alpha:!0,antialias:!0})).setPixelRatio(window.devicePixelRatio),renderer.setSize(WIDTH,HEIGHT),renderer.shadowMap.enabled=!0,raycaster=new THREE.Raycaster,(container=document.getElementById("world")).appendChild(renderer.domElement),window.addEventListener("resize",handleWindowResize,!1)}function handleWindowResize(){HEIGHT=window.innerHeight,WIDTH=window.innerWidth,renderer.setSize(WIDTH,HEIGHT),camera.aspect=WIDTH/HEIGHT,camera.updateProjectionMatrix()}function createLights(){var e=new THREE.PointLight(16777215);e.position.set(0,-600,600),scene.add(e)}window.addEventListener("load",init,!1);var direction=null;function handleKeyBoardDown(e){switch(e.keyCode){case 37:e.preventDefault(),direction="left";break;case 38:e.preventDefault(),direction="up";break;case 39:e.preventDefault(),direction="right";break;case 40:e.preventDefault(),direction="down"}}function handleKeyBoardUp(e){}var mousePos=new THREE.Vector2(0,0),mouseProjectPos=new THREE.Vector3(0,0,0),rightClick={x:0,z:0};function handleMouseMove(e){var t=e.clientX/WIDTH*2-1,o=1-e.clientY/HEIGHT*2;mouseProjectPos=toWorldPosition(e,mousePos={x:t,y:o})}function toScreenPosition(e,t){var o=new THREE.Vector3,n=.5*renderer.context.canvas.width,i=.5*renderer.context.canvas.height;return e.updateMatrixWorld(),o.setFromMatrixPosition(e.matrixWorld),o.project(t),o.x=o.x*n+n,o.y=-o.y*i+i,{x:o.x,y:o.y}}function toWorldPosition(e,t){var o=new THREE.Vector3;o.set(t.x,t.y,.5),o.unproject(camera);var n=o.sub(camera.position).normalize(),i=-(camera.position.z-50)/n.z;return camera.position.clone().add(n.multiplyScalar(i))}function onDocumentMouseDown(e){e.preventDefault(),raycaster.setFromCamera(mousePos,camera);var t=raycaster.intersectObjects(mapTiles);t.length>0&&(Player.targetPos.x=t[0].point.x,Player.targetPos.y=t[0].point.y)}function onRightClick(e){e.preventDefault(),raycaster.setFromCamera(mousePos,camera);var t=raycaster.intersectObjects(mapTiles);t.length>0&&(rightClick.x=t[0].point.x,rightClick.y=t[0].point.y),char.bulletFactory.create()}function hitTest(){for(var e=blobl,t=(new THREE.Box3).setFromObject(e.mesh),o=0;o<Game.collidableMesh.length;o++){var n=Game.collidableMesh[o],i=(new THREE.Box3).setFromObject(n.mesh),r=t.intersectsBox(i);r&&console.log(r)}}function init(){document.addEventListener("mousemove",handleMouseMove,!1),document.body.addEventListener("mousedown",function(e){0===e.button?(Player.isLeftClick=!0,onDocumentMouseDown(e)):2===e.button&&(Player.isRightClick=!0,onRightClick(e))},!1),document.body.addEventListener("mouseup",function(e){0===e.button?Player.isLeftClick=!1:2===e.button&&(Player.isRightClick=!1)},!1),document.addEventListener("contextmenu",function(e){return e.preventDefault()}),setTimeout(function(){enemiesSpawn()},2e3),createScene(),createLights(),createBoardGame(),createCharacter(),loop()}var deltaTime,mvtTime=0,newTime=Date.now(),oldTime=Date.now(),score=0;function loop(){deltaTime=newTime-oldTime,oldTime=newTime,newTime=Date.now(),mvtTime+=deltaTime,animateCharacter(char.body),char.bulletFactory.update(),void 0!==blobl&&hitTest(),renderer.render(scene,camera),requestAnimationFrame(loop)}var _createClass=function(){function e(e,t){for(var o=0;o<t.length;o++){var n=t[o];n.enumerable=n.enumerable||!1,n.configurable=!0,"value"in n&&(n.writable=!0),Object.defineProperty(e,n.key,n)}}return function(t,o,n){return o&&e(t.prototype,o),n&&e(t,n),t}}();function _classCallCheck(e,t){if(!(e instanceof t))throw new TypeError("Cannot call a class as a function")}var Bullet=function(){function e(t,o,n,i){_classCallCheck(this,e),this.geom=new THREE.BoxGeometry(t,o,n,1,1,1),this.mat=new THREE.MeshPhongMaterial({color:i,flatShading:!0}),this.mesh=new THREE.Mesh(this.geom,this.mat),this.mvt={x:0,z:0}}return _createClass(e,[{key:"update",value:function(){this.mesh.position.x+=5*this.mvt.x,this.mesh.position.y+=5*this.mvt.y}}]),e}(),BulletFactory=function(){function e(){_classCallCheck(this,e),this.bullets=[]}return _createClass(e,[{key:"create",value:function(){var e=new Bullet(2,2,2,16777215);e.mesh.position.z=12,e.mesh.position.x=char.mesh.position.x,e.mesh.position.y=char.mesh.position.y;var t=rightClick.x-e.mesh.position.x,o=rightClick.y-e.mesh.position.y,n=Math.atan2(o,t);e.mvt.x=Math.cos(n),e.mvt.y=Math.sin(n),scene.add(e.mesh),Game.collidableMesh.push(e),this.bullets.push(e)}},{key:"update",value:function(){for(var e=0;e<this.bullets.length;e++)this.bullets[e].update()}}]),e}();_createClass=function(){function e(e,t){for(var o=0;o<t.length;o++){var n=t[o];n.enumerable=n.enumerable||!1,n.configurable=!0,"value"in n&&(n.writable=!0),Object.defineProperty(e,n.key,n)}}return function(t,o,n){return o&&e(t.prototype,o),n&&e(t,n),t}}();function _possibleConstructorReturn(e,t){if(!e)throw new ReferenceError("this hasn't been initialised - super() hasn't been called");return!t||"object"!=typeof t&&"function"!=typeof t?e:t}function _inherits(e,t){if("function"!=typeof t&&null!==t)throw new TypeError("Super expression must either be null or a function, not "+typeof t);e.prototype=Object.create(t&&t.prototype,{constructor:{value:e,enumerable:!1,writable:!0,configurable:!0}}),t&&(Object.setPrototypeOf?Object.setPrototypeOf(e,t):e.__proto__=t)}function _classCallCheck(e,t){if(!(e instanceof t))throw new TypeError("Cannot call a class as a function")}var char,CharColors={mainColor:664644,outlinerColor:14222184},speedRot=.03,Bodypart=function e(t,o,n,i,r){_classCallCheck(this,e),this.object=new THREE.Object3D,this.geom=new THREE.BoxGeometry(t,n,o,1,1,1),this.mat=new THREE.MeshPhongMaterial({color:i,flatShading:!0}),this.mesh=new THREE.Mesh(this.geom,this.mat),this.mesh.castShadow=!0,this.outlinerMat=new THREE.MeshBasicMaterial({color:CharColors.outlinerColor,side:THREE.BackSide}),this.outliner=new THREE.Mesh(this.geom,this.outlinerMat),this.outliner.scale.multiplyScalar(1.1),this.object.add(this.mesh),this.object.add(this.outliner),this.name=r},Leg=function(e){function t(e,o,n,i,r){_classCallCheck(this,t);var a=_possibleConstructorReturn(this,(t.__proto__||Object.getPrototypeOf(t)).call(this,e,o,n,i,r));return a.mesh.geometry.translate(0,0,-1),a.mesh.position.z=-2,a.outliner.position.z=2.7,a.mesh.position.x="leftLeg"==a.name?-.9:.9,a.outliner.position.set(a.mesh.position.x,a.mesh.position.y,a.mesh.position.z),a.mvt="leftLeg"==a.name?"backward":"forward",a.rot="leftLeg"==a.name?-speedRot:speedRot,a}return _inherits(t,Bodypart),_createClass(t,[{key:"move",value:function(){this.object.rotation.x>.3&&"forward"==this.mvt?(this.rot=-speedRot,this.mvt="backward"):this.object.rotation.x<-.3&&"backward"==this.mvt&&(this.rot=speedRot,this.mvt="forward"),this.object.rotation.x+=this.rot}}]),t}(),Arm=function(e){function t(e,o,n,i,r){_classCallCheck(this,t);var a=_possibleConstructorReturn(this,(t.__proto__||Object.getPrototypeOf(t)).call(this,e,o,n,i,r));return a.mesh.geometry.translate(0,0,-1.2),a.mesh.position.z=.6,a.mesh.position.x="leftArm"==a.name?-2.4:2.4,a.outliner.position.set(a.mesh.position.x,a.mesh.position.y,a.mesh.position.z),a.mvt="rightArm"==a.name?"backward":"forward",a.rot="rightArm"==a.name?-speedRot:speedRot,a}return _inherits(t,Bodypart),_createClass(t,[{key:"move",value:function(){this.object.rotation.x>.3&&"forward"==this.mvt?(this.rot=-speedRot,this.mvt="backward"):this.object.rotation.x<-.3&&"backward"==this.mvt&&(this.rot=speedRot,this.mvt="forward"),this.object.rotation.x+=this.rot}}]),t}(),Head=function(e){function t(e,o,n,i,r){_classCallCheck(this,t);var a=_possibleConstructorReturn(this,(t.__proto__||Object.getPrototypeOf(t)).call(this,e,o,n,i,r));return a.mesh.position.z=4,a.outliner.position.set(a.mesh.position.x,a.mesh.position.y,a.mesh.position.z),a.rightEye=new Bodypart(.8,.8,.8,16777215,"rightEye"),a.rightEye.mesh.position.x+=1,a.rightEye.mesh.position.y-=2.3,a.rightEye.mesh.position.z+=.8,a.mesh.add(a.rightEye.mesh),a.leftEye=new Bodypart(.8,.8,.8,268435455,"leftEye"),a.leftEye.mesh.position.x+=-1,a.leftEye.mesh.position.y-=2.3,a.leftEye.mesh.position.z+=.8,a.mesh.add(a.leftEye.mesh),a.mvt="up",a.headMvt=.025,a}return _inherits(t,Bodypart),_createClass(t,[{key:"move",value:function(){this.object.position.z>4.1&&"up"==this.mvt?(this.headMvt=-.025,this.mvt="down"):this.object.position.z<3.8&&"down"==this.mvt&&(this.headMvt=.025,this.mvt="up"),this.object.position.z+=this.headMvt}}]),t}(),Body=function(e){function t(e,o,n,i,r){_classCallCheck(this,t);var a=_possibleConstructorReturn(this,(t.__proto__||Object.getPrototypeOf(t)).call(this,e,o,n,i,r));return a.mvt=!1,a.movable=[],a.object.rotation.set(-Math.PI/2,0,0),a.head=new Head(4.8,4.8,4.8,CharColors.mainColor,"head"),a.object.add(a.head.mesh),a.object.add(a.head.outliner),a.movable.push(a.head),a.leftLeg=new Leg(1.6,1,1.8,CharColors.mainColor,"leftLeg"),a.rightLeg=new Leg(1.6,1,1.8,CharColors.mainColor,"rightLeg"),a.object.add(a.leftLeg.object),a.object.add(a.rightLeg.object),a.movable.push(a.leftLeg,a.rightLeg),a.leftArm=new Arm(.8,2.4,1,CharColors.mainColor,"leftArm"),a.rightArm=new Arm(.8,2.4,1,CharColors.mainColor,"rightArm"),a.object.add(a.leftArm.object),a.object.add(a.rightArm.object),a.movable.push(a.leftArm,a.rightArm),a}return _inherits(t,Bodypart),_createClass(t,[{key:"update",value:function(){}},{key:"move",value:function(){this.head.move();for(var e=0;e<this.movable.length;e++)this.movable[e].move()}}]),t}(),Char=function(){function e(t){_classCallCheck(this,e),this.mesh=new THREE.Object3D,this.mesh.name="character",this.name=t,this.state="still",this.mvt="false",this.body=new Body(4,4,2.8,CharColors.mainColor),this.mesh.add(this.body.object),this.bulletFactory=new BulletFactory}return _createClass(e,[{key:"move",value:function(){if(this.body.move(),Player.isLeftClick||this.body.mvt){var e=Player.targetPos.x-this.mesh.position.x,t=Player.targetPos.y-this.mesh.position.y,o=Math.atan2(t,e),n=Math.cos(o),i=Math.sin(o);this.mesh.position.x+=1*n,this.mesh.position.y+=1*i,Math.ceil(Player.targetPos.x/10)==Math.ceil(this.mesh.position.x/10)&&Math.ceil(Player.targetPos.y/10)==Math.ceil(this.mesh.position.y/10)?this.body.mvt=!1:this.body.mvt=!0}var r=new THREE.Vector3(mouseProjectPos.x,mouseProjectPos.y,12);this.mesh.up=new THREE.Vector3(0,0,1),this.mesh.lookAt(r)}}]),e}();function createCharacter(){(char=new Char).body.mesh.geometry.center(),char.mesh.position.z=12,char.mesh.scale.set(1.5,1.5,1.5),scene.add(char.mesh)}function animateCharacter(e){char.move()}_createClass=function(){function e(e,t){for(var o=0;o<t.length;o++){var n=t[o];n.enumerable=n.enumerable||!1,n.configurable=!0,"value"in n&&(n.writable=!0),Object.defineProperty(e,n.key,n)}}return function(t,o,n){return o&&e(t.prototype,o),n&&e(t,n),t}}();function _classCallCheck(e,t){if(!(e instanceof t))throw new TypeError("Cannot call a class as a function")}var blobl,Enemy=function(){function e(t,o,n,i,r){_classCallCheck(this,e),this.geom=new THREE.BoxGeometry(t,o,n,1,1,1),this.mat=new THREE.MeshPhongMaterial({color:i,flatShading:!0}),this.mesh=new THREE.Mesh(this.geom,this.mat),this.mesh.castShadow=!0,this.name=r}return _createClass(e,[{key:"animation",value:function(){}},{key:"move",value:function(e,t){}},{key:"hitTest",value:function(e){}}]),e}();function enemiesSpawn(){(blobl=new Enemy(4,4,4,10076749,"blobl")).mesh.position.x+=150,blobl.mesh.position.y+=150,blobl.mesh.position.z+=10,blobl.mesh.scale.set(2,2,2),scene.add(blobl.mesh)}function _classCallCheck(e,t){if(!(e instanceof t))throw new TypeError("Cannot call a class as a function")}var board,drillingMachine,BoardGame=function e(){_classCallCheck(this,e),this.mesh=new THREE.Object3D,this.tileSize=12,this.size=32;for(var t=new THREE.BoxGeometry(this.tileSize,this.tileSize,this.tileSize),o=0;o<32;o++){o<16?1:1;for(var n=0;n<32;n++){n<16?1:1;for(var i=0;i<1;i++){var r=new THREE.Mesh(t,new THREE.MeshPhongMaterial({color:6250335,flatShading:!0}));r.position.x=o*(1.05*this.tileSize),r.position.y=n*(1.05*this.tileSize),r.position.z=-i*(1.05*this.tileSize),r.castShadow=!0,r.receiveShadow=!0,this.mesh.add(r),mapTiles.push(r)}}}},mapTiles=[];function createBoardGame(){(board=new BoardGame(Colors.blue)).mesh.translateX(1.05*board.tileSize*-16),board.mesh.translateY(1.05*board.tileSize*-16),scene.add(board.mesh)}var DrillingMachine=function e(){_classCallCheck(this,e),this.geom=new THREE.BoxGeometry(24,24,24,1,1,1),this.mesh=new THREE.Mesh(this.geom,new THREE.MeshBasicMaterial({color:1581167,side:THREE.BackSide}))};function createDrilling(){(drillingMachine=new DrillingMachine).mesh.position.z+=50,scene.add(drillingMachine.mesh)}console.log("blah");_createClass=function(){function e(e,t){for(var o=0;o<t.length;o++){var n=t[o];n.enumerable=n.enumerable||!1,n.configurable=!0,"value"in n&&(n.writable=!0),Object.defineProperty(e,n.key,n)}}return function(t,o,n){return o&&e(t.prototype,o),n&&e(t,n),t}}();function _possibleConstructorReturn(e,t){if(!e)throw new ReferenceError("this hasn't been initialised - super() hasn't been called");return!t||"object"!=typeof t&&"function"!=typeof t?e:t}function _inherits(e,t){if("function"!=typeof t&&null!==t)throw new TypeError("Super expression must either be null or a function, not "+typeof t);e.prototype=Object.create(t&&t.prototype,{constructor:{value:e,enumerable:!1,writable:!0,configurable:!0}}),t&&(Object.setPrototypeOf?Object.setPrototypeOf(e,t):e.__proto__=t)}function _classCallCheck(e,t){if(!(e instanceof t))throw new TypeError("Cannot call a class as a function")}var ScreenSystem=function(){function e(t){_classCallCheck(this,e),this.container=t,this.currentScreen=null}return _createClass(e,[{key:"setScreen",value:function(e){this.previousScreen=this.currentScreen,this.currentScreen=e,this.previousScreen&&this.removeScreen(this.previousScreen.display),console.log(this.currentScreen),this.container.appendChild(this.currentScreen.display),this.currentScreen.enter(this.setScreen.bind(this))}},{key:"removeScreen",value:function(e){this.container.removeChild(e)}}]),e}(),Screen=function(){function e(){_classCallCheck(this,e),this.display=null}return _createClass(e,[{key:"enter",value:function(){}},{key:"exit",value:function(){}},{key:"update",value:function(){}}]),e}();function log(){console.log("work plz")}var MainScreen=function(e){function t(){_classCallCheck(this,t);var e=_possibleConstructorReturn(this,(t.__proto__||Object.getPrototypeOf(t)).call(this));return e.display=document.querySelector(".template").content.querySelector(".mainScreen").cloneNode(!0),e.button=e.display.querySelector("button"),e}return _inherits(t,Screen),_createClass(t,[{key:"enter",value:function(e){this.exitCallback=e,console.log(this.button),this.button.addEventListener("click",this.navigate.bind(this))}},{key:"navigate",value:function(e){console.log("yeah"),this.exitCallback(secondScreen)}}]),t}(),mainScreen=new MainScreen,SecondScreen=function(e){function t(){_classCallCheck(this,t);var e=_possibleConstructorReturn(this,(t.__proto__||Object.getPrototypeOf(t)).call(this));return e.display=document.querySelector(".template").content.querySelector(".secondScreen").cloneNode(!0),e}return _inherits(t,Screen),_createClass(t,[{key:"enter",value:function(e){this.exitCallback=e}}]),t}(),secondScreen=new SecondScreen,mainContaint=document.querySelector(".app"),AppScreens=new ScreenSystem(mainContaint);AppScreens.setScreen(mainScreen);